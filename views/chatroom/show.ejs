<div class="container" style="margin-top: 200px;">
	<p>Messages:</p>
	<div id="messages">
		<% for(var i=0; i<chatroom.messages.length; i++) { %>
			<p>
				<b><%= chatroom.messages[i].posterName %>: </b><%= chatroom.messages[i].message %>
			</p>
		<% } %>
	</div>
	<form id="chat-input">
		<input type="hidden" name="room" value=<%= chatroom.id %>>
		<input type="hidden" name="poster" value=<%= currentUser %>>
		<input type="hidden" name="posterName" value="<%= currentUserName %>">
		<input type="text" name="message" id="message-input">
		<button type="submit" class="btn btn-default">Send</button>
	</form>
	<script type="text/javascript">
	$(function() {

		window.addEventListener('beforeunload', function(e) {
			io.socket.get('/chatroom/leaveRoom/' + location.pathname.split('/')[3]);
		});

		io.socket.get('/chatroom/joinRoom/' + location.pathname.split('/')[3]);
		io.socket.on('join', function (data) {
			console.log(data.msg);
		});
		io.socket.on('leave', function (data) {
			console.log(data.msg);
		});

		io.socket.on('created', function (data) {
			$('#messages').append(
				'<p><b>' + data.poster + ': </b>' + data.msg + '</p>');
		});
		$('#chat-input').on('submit', function (e) {
			e.preventDefault();
			var form = $('#chat-input').serialize();
			$.post('/message/create', form);
			$('#message-input').val('');

		})
	});
	</script>
	<form action="/chatroom/invite/<%= chatroom.id %>/user/<%= chatroom.owner %>" method="POST">
		<button type="submit" class="btn btn-default">Invite Users</button>
	</form>
</div>